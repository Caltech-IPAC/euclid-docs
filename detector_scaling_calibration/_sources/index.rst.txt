.. SIR_DetectorScaling documentation master file, created by
   sphinx-quickstart on Mon Aug 18 14:25:15 2025.
   You can adapt this file completely to your liking, but it should at least
   contain the root `toctree` directive.

SScience goals for SIR Detector Scaling
========================================
RSIR Detector Scaling has two components - a calibration module and an apply module. In totality, the goal is to apply a multiplicative correction to the detector response to a uniform illumination. The correction is applied and tailored to each detector. This correction attempts to reduce detector-dependent variations on different spatial scales including:

(a) Pixel-to-pixel variations resulting from intrinsic QE differences across each detector
(b) Small scale (~ 100 px) QE variations due to repeatable structures in the background detector response which are present at the few percent level in localized areas on each detector.  These “void” structures are very repeatable and relate to missing epoxy layers in the manufacture of the H2RG detectors.
(c) Large scales QE corrections (> 100 px, up to detector scale), to account for detector-scale intrinsic gradients in the response of the detector to uniform light. The magnitude of these variations are generally small (< 1-2%) and vary from one detector to another.

This specific documentation handles only the calibration module, appropriately named as SIR_DetectorScalingCalibration, where the calibration product is generated. In the apply module, this calibration product is applied. For the apply module, please visit https://caltech-ipac.github.io/euclid-docs/detector_scaling_apply/


Documentation for SIR DetectorScalingCalibration (calibration module)
=====================================================================

In this document, you will find the documentation for Euclid's SIR DetectorScalingCalibration module 
as well as documentation for the underlying Python classes. This module derives a pixel-wise multiplication correction factor to the detector response to a uniform illumination and is tailored to each detector. This multiplication factor, generated as a 2D map, is needed as input by the SIR DetectorScaling (apply) module under SIR Pipeline. 


Module Usage
============

The full details of the latest command-line usage documentation can always be found, using the command:

.. code-block:: bash

    E-Run SIR_Calibration SIR_DetectorScalingCalibration --help

In summary, the most important command-line switches and arguments, when running the module in stand-alone mode, are:

Inputs and Outputs
----------------------

``--workdir WORKDIR``
     The root working directory where all of the files are located.

``--config CONFIG``
    The name of the configuration file, relative to the ``workdir``.

``--logdir LOGDIR``   
    The name of the logging directory, relative to the ``workdir``.

``--mdb MDB``
    The Mission Database XML file, containing all key instrument and mission parameters, relative to the ``workdir``.

``--outfile OUTPUT``
    The name of the output FITS file, containing 2D weighted QE maps, for all 16 detectors, for both RGS and BGS grisms, relative to 
    the ``workdir``.


.. toctree::
   :maxdepth: 2
   :caption: Code Documentation:

   modules


Example Run
===========
An example run can be submitted with the following command,

.. code-block:: bash

   E-Run SIR_Calibration CreateDetectorScalingFile --workdir /stage/euclid-staff-idas/dev-SIR/Ranga-project-data/data_all --outfile test_resources --mdb input/EUC_MDB_MISSIONCONFIGURATION_DEV_2023-12-15-1.xml


UML Diagrams
============

TODO: Put a summary of the UML diagrams.


Index
==================

* :ref:`modindex`

